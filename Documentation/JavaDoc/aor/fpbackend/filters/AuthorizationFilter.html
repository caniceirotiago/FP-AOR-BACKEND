<!DOCTYPE HTML>
<html lang="pt">
<head>
<!-- Generated by javadoc (21) on Fri Jul 12 20:05:51 WEST 2024 -->
<title>AuthorizationFilter</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="dc.created" content="2024-07-12">
<meta name="description" content="declaration: package: aor.fpbackend.filters, class: AuthorizationFilter">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../script-dir/jquery-ui.min.css" title="Style">
<script type="text/javascript" src="../../../script.js"></script>
<script type="text/javascript" src="../../../script-dir/jquery-3.6.1.min.js"></script>
<script type="text/javascript" src="../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var pathtoroot = "../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top"><button id="navbar-toggle-button" aria-controls="navbar-top" aria-expanded="false" aria-label="Toggle navigation links"><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span></button>
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../help-doc.html#class">Help</a></li>
</ul>
<ul class="sub-nav-list-small">
<li>
<p>Summary:</p>
<ul>
<li>Nested</li>
<li>Field</li>
<li><a href="#constructor-summary">Constr</a></li>
<li><a href="#method-summary">Method</a></li>
</ul>
</li>
<li>
<p>Detail:</p>
<ul>
<li>Field</li>
<li><a href="#constructor-detail">Constr</a></li>
<li><a href="#method-detail">Method</a></li>
</ul>
</li>
</ul>
</div>
<div class="sub-nav">
<div id="navbar-sub-list">
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor-summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor-detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><a href="../../../search.html">SEARCH</a>
<input type="text" id="search-input" disabled placeholder="Search">
<input type="reset" id="reset-button" disabled value="reset">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">aor.fpbackend.filters</a></div>
<h1 title="Class AuthorizationFilter" class="title">Class AuthorizationFilter</h1>
</div>
<div class="inheritance" title="Inheritance Tree"><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">java.lang.Object</a>
<div class="inheritance">aor.fpbackend.filters.AuthorizationFilter</div>
</div>
<section class="class-description" id="class-description">
<dl class="notes">
<dt>All Implemented Interfaces:</dt>
<dd><code>jakarta.ws.rs.container.ContainerRequestFilter</code></dd>
</dl>
<hr>
<div class="type-signature"><span class="annotations">@Provider
@Priority(2000)
</span><span class="modifiers">public class </span><span class="element-name type-name-label">AuthorizationFilter</span>
<span class="extends-implements">extends <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>
implements jakarta.ws.rs.container.ContainerRequestFilter</span></div>
<div class="block"><p>The <code>AuthorizationFilter</code> class is responsible for handling the authorization of incoming HTTP requests.
 It intercepts requests, validates authentication tokens, sets up security contexts, and checks user permissions
 to ensure that only authorized users can access protected resources.</p>

 <p>This class utilizes several Jakarta EE and Java technologies:</p>
 <ul>
   <li>Jakarta EE annotations such as <code>@Provider</code> and <code>@Priority</code> to integrate with the Jakarta REST framework.</li>
   <li>EJBs for business logic and session management, including <code>UserBean</code>, <code>ConfigurationBean</code>, <code>SessionBean</code>, and <code>ProjectMembershipDao</code>.</li>
   <li>Contextual dependencies injection using <code>@Context</code> for accessing HTTP request information and resource metadata.</li>
   <li>JSON Web Tokens (JWT) for secure token validation and renewal using the <code>Jwts</code> class and a custom <code>JwtKeyProvider</code>.</li>
   <li>ThreadContext from Apache Log4j for logging and tracking user sessions across requests.</li>
 </ul>

 <p>The main responsibilities of this filter include:</p>
 <ul>
   <li>Identifying public endpoints that do not require authentication using the <code>isPublicEndpoint</code> method.</li>
   <li>Extracting and validating the authentication token from the request headers.</li>
   <li>Setting up the security context with user-specific details for authenticated requests.</li>
   <li>Renewing authentication tokens if they are about to expire, enhancing session security and continuity.</li>
   <li>Checking user permissions against annotated methods to ensure that the user has the necessary rights to perform the requested operation.</li>
 </ul>

 <p>Key methods in this class include:</p>
 <ul>
   <li><code>filter</code>: Main method that processes incoming requests and applies authorization logic.</li>
   <li><code>handleTokenRenewal</code>: Checks and renews the authentication token if necessary.</li>
   <li><code>setupThreadContext</code>: Configures logging context for the current request.</li>
   <li><code>setSecurityContext</code>: Sets the security context for the current request, providing user-specific security information.</li>
   <li><code>checkAuthorization</code>: Verifies if the user has the necessary permissions to access the requested resource.</li>
 </ul>

 <p>Exception handling is implemented to ensure that unauthorized or erroneous requests are appropriately managed, returning relevant HTTP responses.</p>

 <p>This filter also makes use of several custom security annotations to enforce method-level security:</p>
 <ul>
   <li><code>@RequiresMethodPermission</code>: This annotation is used to specify that a method requires a particular permission.
       The <code>checkAuthorization</code> method checks if the authenticated user has the required permission before allowing access.</li>
   <li><code>@RequiresProjectRolePermission</code>: This annotation ensures that the user has a specific role in the project identified by the request.
       The filter extracts the project ID from the request and verifies the user's role in the project.</li>
   <li><code>@RequiresProjectMemberPermission</code>: This annotation ensures that the user is a member of the project identified by the request.
       Similar to <code>@RequiresProjectRolePermission</code>, but only checks for membership, not a specific role.</li>
   <li><code>@RequiresPermissionByUserOnIndividualMessage</code>: This annotation is used for endpoints dealing with individual messages.
       It checks if the user is either the sender or receiver of the message.</li>
   <li><code>@RequiresPermissionByUserOnIndividualMessageAllMessages</code>: This annotation is used for endpoints dealing with multiple messages.
       It ensures that the user has permission to access the messages, typically by checking the user ID.</li>
 </ul></div>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<li>
<section class="constructor-summary" id="constructor-summary">
<h2>Constructor Summary</h2>
<div class="caption"><span>Constructors</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Constructor</div>
<div class="table-header col-last">Description</div>
<div class="col-constructor-name even-row-color"><code><a href="#%3Cinit%3E()" class="member-name-link">AuthorizationFilter</a>()</code></div>
<div class="col-last even-row-color">&nbsp;</div>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab4" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab4', 3)" class="table-tab">Concrete Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel">
<div class="summary-table three-column-summary" aria-labelledby="method-summary-table-tab0">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#extractTokenFromCookieHeader(java.lang.String)" class="member-name-link">extractTokenFromCookieHeader</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;cookieHeader)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Extracts the authentication token from the cookie header.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#filter(jakarta.ws.rs.container.ContainerRequestContext)" class="member-name-link">filter</a><wbr>(jakarta.ws.rs.container.ContainerRequestContext&nbsp;requestContext)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Filters incoming requests to enforce authorization rules.</div>
</div>
</div>
</div>
</div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-java.lang.Object">Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></h3>
<code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)" title="class or interface in java.lang" class="external-link">equals</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#getClass()" title="class or interface in java.lang" class="external-link">getClass</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#hashCode()" title="class or interface in java.lang" class="external-link">hashCode</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#notify()" title="class or interface in java.lang" class="external-link">notify</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#notifyAll()" title="class or interface in java.lang" class="external-link">notifyAll</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#toString()" title="class or interface in java.lang" class="external-link">toString</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#wait()" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#wait(long)" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#wait(long,int)" title="class or interface in java.lang" class="external-link">wait</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<li>
<section class="constructor-details" id="constructor-detail">
<h2>Constructor Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="&lt;init&gt;()">
<h3>AuthorizationFilter</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">AuthorizationFilter</span>()</div>
</section>
</li>
</ul>
</section>
</li>
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="filter(jakarta.ws.rs.container.ContainerRequestContext)">
<h3>filter</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">filter</span><wbr><span class="parameters">(jakarta.ws.rs.container.ContainerRequestContext&nbsp;requestContext)</span></div>
<div class="block">Filters incoming requests to enforce authorization rules.

 <p>This method intercepts incoming HTTPS requests, checks if the requested path is public,
 validates authentication tokens, renews tokens if necessary, sets up the security context,
 and verifies user permissions. If the token is invalid or the user does not have the required
 permissions, the request is aborted with an appropriate HTTPS response status.</p></div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code>filter</code>&nbsp;in interface&nbsp;<code>jakarta.ws.rs.container.ContainerRequestFilter</code></dd>
<dt>Parameters:</dt>
<dd><code>requestContext</code> - the context of the incoming request</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="extractTokenFromCookieHeader(java.lang.String)">
<h3>extractTokenFromCookieHeader</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></span>&nbsp;<span class="element-name">extractTokenFromCookieHeader</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;cookieHeader)</span></div>
<div class="block">Extracts the authentication token from the cookie header.

 <p>This method parses the "Cookie" header from the HTTPS request to find and extract the value of the "authToken" cookie.
 If the cookie is present, its value is returned; otherwise, null is returned.</p></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>cookieHeader</code> - the "Cookie" header from the HTTPS request</dd>
<dt>Returns:</dt>
<dd>the authentication token, or null if not found</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
</div>
</div>
</body>
</html>
