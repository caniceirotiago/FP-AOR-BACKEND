<!DOCTYPE HTML>
<html lang="pt">
<head>
<!-- Generated by javadoc (21) on Fri Jul 12 20:05:51 WEST 2024 -->
<title>SessionBean</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="dc.created" content="2024-07-12">
<meta name="description" content="declaration: package: aor.fpbackend.bean, class: SessionBean">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../script-dir/jquery-ui.min.css" title="Style">
<script type="text/javascript" src="../../../script.js"></script>
<script type="text/javascript" src="../../../script-dir/jquery-3.6.1.min.js"></script>
<script type="text/javascript" src="../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var pathtoroot = "../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top"><button id="navbar-toggle-button" aria-controls="navbar-top" aria-expanded="false" aria-label="Toggle navigation links"><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span></button>
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../help-doc.html#class">Help</a></li>
</ul>
<ul class="sub-nav-list-small">
<li>
<p>Summary:</p>
<ul>
<li>Nested</li>
<li>Field</li>
<li><a href="#constructor-summary">Constr</a></li>
<li><a href="#method-summary">Method</a></li>
</ul>
</li>
<li>
<p>Detail:</p>
<ul>
<li>Field</li>
<li><a href="#constructor-detail">Constr</a></li>
<li><a href="#method-detail">Method</a></li>
</ul>
</li>
</ul>
</div>
<div class="sub-nav">
<div id="navbar-sub-list">
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor-summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor-detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><a href="../../../search.html">SEARCH</a>
<input type="text" id="search-input" disabled placeholder="Search">
<input type="reset" id="reset-button" disabled value="reset">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">aor.fpbackend.bean</a></div>
<h1 title="Class SessionBean" class="title">Class SessionBean</h1>
</div>
<div class="inheritance" title="Inheritance Tree"><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">java.lang.Object</a>
<div class="inheritance">aor.fpbackend.bean.SessionBean</div>
</div>
<section class="class-description" id="class-description">
<dl class="notes">
<dt>All Implemented Interfaces:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/io/Serializable.html" title="class or interface in java.io" class="external-link">Serializable</a></code></dd>
</dl>
<hr>
<div class="type-signature"><span class="modifiers">public class </span><span class="element-name type-name-label">SessionBean</span>
<span class="extends-implements">extends <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>
implements <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/io/Serializable.html" title="class or interface in java.io" class="external-link">Serializable</a></span></div>
<div class="block">SessionBean is a stateless EJB that manages user sessions, including creation, validation,
 and cleanup of session tokens. It handles tasks such as generating JWT tokens, validating
 authentication and session tokens, and managing session expiration and invalidation.
 <br>
 This bean interacts with various DAOs to fetch user and session data and relies on utility
 classes for JWT operations and websocket communication.
 <br>
 <br>
 Technologies Used:
 <ul>
     <li><b>Java EE</b>: For building the EJB and managing transactions.</li>
     <li><b>JWT</b>: For token generation and validation via <a href="../utils/JwtKeyProvider.html" title="class in aor.fpbackend.utils"><code>JwtKeyProvider</code></a>.</li>
     <li><b>Jakarta EE</b>: For dependency injection and scheduling.</li>
     <li><b>SLF4J</b>: For logging operations.</li>
 </ul>
 <br>
 <br>
 Dependencies are injected using the <code>EJB</code> annotation, which includes DAOs for user,
 session, and role entities. The bean also uses utility classes for JWT operations and
 websocket communication.
 <br></div>
<dl class="notes">
<dt>See Also:</dt>
<dd>
<ul class="tag-list">
<li><a href="../../../serialized-form.html#aor.fpbackend.bean.SessionBean">Serialized Form</a></li>
</ul>
</dd>
</dl>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<li>
<section class="constructor-summary" id="constructor-summary">
<h2>Constructor Summary</h2>
<div class="caption"><span>Constructors</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Constructor</div>
<div class="table-header col-last">Description</div>
<div class="col-constructor-name even-row-color"><code><a href="#%3Cinit%3E()" class="member-name-link">SessionBean</a>()</code></div>
<div class="col-last even-row-color">&nbsp;</div>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab4" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab4', 3)" class="table-tab">Concrete Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel">
<div class="summary-table three-column-summary" aria-labelledby="method-summary-table-tab0">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#cleanupExpiredTokens()" class="member-name-link">cleanupExpiredTokens</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Scheduled method to clean up expired sessions and manage user sessions.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#createInvalidSession(aor.fpbackend.dto.Authentication.AuthUserDto,jakarta.ws.rs.container.ContainerRequestContext)" class="member-name-link">createInvalidSession</a><wbr>(<a href="../dto/Authentication/AuthUserDto.html" title="class in aor.fpbackend.dto.Authentication">AuthUserDto</a>&nbsp;authUserDto,
 jakarta.ws.rs.container.ContainerRequestContext&nbsp;requestContext)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Invalidates the current session and sets invalid tokens in the request context.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#createNewSessionAndInvalidateOld(aor.fpbackend.dto.Authentication.AuthUserDto,jakarta.ws.rs.container.ContainerRequestContext,long,java.lang.String)" class="member-name-link">createNewSessionAndInvalidateOld</a><wbr>(<a href="../dto/Authentication/AuthUserDto.html" title="class in aor.fpbackend.dto.Authentication">AuthUserDto</a>&nbsp;authUserDto,
 jakarta.ws.rs.container.ContainerRequestContext&nbsp;requestContext,
 long&nbsp;definedTimeout,
 <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;oldToken)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Creates a new session for the user and invalidates the old session.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#generateJwtToken(aor.fpbackend.entity.UserEntity,long,java.lang.String)" class="member-name-link">generateJwtToken</a><wbr>(<a href="../entity/UserEntity.html" title="class in aor.fpbackend.entity">UserEntity</a>&nbsp;user,
 long&nbsp;expirationTime,
 <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;tokenType)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Generates a JSON Web Token (JWT) for the given user with specified expiration time and token type.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#generateNewToken()" class="member-name-link">generateNewToken</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Generates a new secure random token.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>jakarta.ws.rs.core.Response</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#login(aor.fpbackend.dto.User.UserLoginDto)" class="member-name-link">login</a><wbr>(<a href="../dto/User/UserLoginDto.html" title="class in aor.fpbackend.dto.User">UserLoginDto</a>&nbsp;userLogin)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Authenticates a user and creates a new session.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#logout(jakarta.ws.rs.core.SecurityContext)" class="member-name-link">logout</a><wbr>(jakarta.ws.rs.core.SecurityContext&nbsp;securityContext)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Logs out a user by invalidating their session token.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#setConfigurationBean(aor.fpbackend.bean.ConfigurationBean)" class="member-name-link">setConfigurationBean</a><wbr>(<a href="ConfigurationBean.html" title="class in aor.fpbackend.bean">ConfigurationBean</a>&nbsp;configurationBean)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#setPassEncoder(aor.fpbackend.utils.PassEncoder)" class="member-name-link">setPassEncoder</a><wbr>(<a href="../utils/PassEncoder.html" title="class in aor.fpbackend.utils">PassEncoder</a>&nbsp;passEncoder)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#setRoleDao(aor.fpbackend.dao.RoleDao)" class="member-name-link">setRoleDao</a><wbr>(<a href="../dao/RoleDao.html" title="class in aor.fpbackend.dao">RoleDao</a>&nbsp;roleDao)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#setSessionDao(aor.fpbackend.dao.SessionDao)" class="member-name-link">setSessionDao</a><wbr>(<a href="../dao/SessionDao.html" title="class in aor.fpbackend.dao">SessionDao</a>&nbsp;sessionDao)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#setUserDao(aor.fpbackend.dao.UserDao)" class="member-name-link">setUserDao</a><wbr>(<a href="../dao/UserDao.html" title="class in aor.fpbackend.dao">UserDao</a>&nbsp;userDao)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="../dto/Authentication/AuthUserDto.html" title="class in aor.fpbackend.dto.Authentication">AuthUserDto</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#validateAuthTokenAndGetUserDetails(java.lang.String)" class="member-name-link">validateAuthTokenAndGetUserDetails</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;token)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Validates a JSON Web Token (JWT) and retrieves the authenticated user's details.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="../dto/Authentication/AuthUserDto.html" title="class in aor.fpbackend.dto.Authentication">AuthUserDto</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#validateSessionTokenAndGetUserDetails(java.lang.String)" class="member-name-link">validateSessionTokenAndGetUserDetails</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;token)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Validates a session token and retrieves the authenticated user's details.</div>
</div>
</div>
</div>
</div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-java.lang.Object">Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></h3>
<code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)" title="class or interface in java.lang" class="external-link">equals</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#getClass()" title="class or interface in java.lang" class="external-link">getClass</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#hashCode()" title="class or interface in java.lang" class="external-link">hashCode</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#notify()" title="class or interface in java.lang" class="external-link">notify</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#notifyAll()" title="class or interface in java.lang" class="external-link">notifyAll</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#toString()" title="class or interface in java.lang" class="external-link">toString</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#wait()" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#wait(long)" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#wait(long,int)" title="class or interface in java.lang" class="external-link">wait</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<li>
<section class="constructor-details" id="constructor-detail">
<h2>Constructor Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="&lt;init&gt;()">
<h3>SessionBean</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">SessionBean</span>()</div>
</section>
</li>
</ul>
</section>
</li>
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="login(aor.fpbackend.dto.User.UserLoginDto)">
<h3>login</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">jakarta.ws.rs.core.Response</span>&nbsp;<span class="element-name">login</span><wbr><span class="parameters">(<a href="../dto/User/UserLoginDto.html" title="class in aor.fpbackend.dto.User">UserLoginDto</a>&nbsp;userLogin)</span>
                                  throws <span class="exceptions"><a href="../exception/InvalidCredentialsException.html" title="class in aor.fpbackend.exception">InvalidCredentialsException</a></span></div>
<div class="block">Authenticates a user and creates a new session.
 <br>
 This method performs the following steps:
 <ul>
     <li>Validates the user's email and password.</li>
     <li>Generates JWT tokens for authentication and session management.</li>
     <li>Creates cookies to store the tokens and persists the session information.</li>
 </ul>
 <br>

 <br>
 Technologies Used:
 <ul>
     <li><b>BCrypt</b>: For password hashing and validation via `PassEncoder`.</li>
     <li><b>JWT</b>: For token generation and validation via `SessionBean`.</li>
     <li><b>Cookie html only</b>: For storing the tokens in the client's browser.</li>
 </ul>
 <br></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>userLogin</code> - the DTO containing the user's login credentials.</dd>
<dt>Returns:</dt>
<dd>a Response containing the authentication and session cookies.</dd>
<dt>Throws:</dt>
<dd><code><a href="../exception/InvalidCredentialsException.html" title="class in aor.fpbackend.exception">InvalidCredentialsException</a></code> - if the email or password is incorrect.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="logout(jakarta.ws.rs.core.SecurityContext)">
<h3>logout</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">logout</span><wbr><span class="parameters">(jakarta.ws.rs.core.SecurityContext&nbsp;securityContext)</span>
            throws <span class="exceptions"><a href="../exception/UserNotFoundException.html" title="class in aor.fpbackend.exception">UserNotFoundException</a></span></div>
<div class="block">Logs out a user by invalidating their session token.
 <br>
 This method performs the following steps:
 <ul>
     <li>Retrieves the authenticated user's details from the security context.</li>
     <li>Invalidates the session associated with the user.</li>
     <li>Logs the logout operation for auditing purposes.</li>
 </ul>
 <br></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>securityContext</code> - the security context containing the authenticated user's details.</dd>
<dt>Throws:</dt>
<dd><code><a href="../exception/UserNotFoundException.html" title="class in aor.fpbackend.exception">UserNotFoundException</a></code> - if the token is invalid or the session cannot be found.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="cleanupExpiredTokens()">
<h3>cleanupExpiredTokens</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">cleanupExpiredTokens</span>()
                          throws <span class="exceptions"><a href="../exception/DatabaseOperationException.html" title="class in aor.fpbackend.exception">DatabaseOperationException</a></span></div>
<div class="block">Scheduled method to clean up expired sessions and manage user sessions.
 <br>
 This method is executed every minute to check for user sessions that are about to expire within the next three minutes
 or have already expired. The primary goal is to ensure that sessions are properly managed, thereby enhancing security
 and user experience. The method performs the following tasks:
 <ul>
     <li>Fetches sessions that are expiring in the next three minutes or have already expired but are still active.</li>
     <li>Logs the number of such sessions for monitoring purposes.</li>
     <li>For each session:
         <ul>
             <li>If the session is expiring in one minute or less, it deactivates the session in the backend, assuming
             that the user does not have an active WebSocket session.</li>
             <li>If the session is expiring in more than one minute but less than three minutes, it sends a forced logout
             request via WebSocket. This prompts the frontend to initiate a REST request that invalidates the authentication cookie.
             (html only)
             </li>
         </ul>
     </li>
 </ul>
 This approach ensures that:
 <ul>
     <li>Active sessions that are about to expire are properly closed, preventing unauthorized access.</li>
     <li>Users are notified of their session's imminent expiration and prompted to re-authenticate, improving security and user experience.</li>
 </ul>
 <br></div>
<dl class="notes">
<dt>Throws:</dt>
<dd><code><a href="../exception/DatabaseOperationException.html" title="class in aor.fpbackend.exception">DatabaseOperationException</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="generateJwtToken(aor.fpbackend.entity.UserEntity,long,java.lang.String)">
<h3>generateJwtToken</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></span>&nbsp;<span class="element-name">generateJwtToken</span><wbr><span class="parameters">(<a href="../entity/UserEntity.html" title="class in aor.fpbackend.entity">UserEntity</a>&nbsp;user,
 long&nbsp;expirationTime,
 <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;tokenType)</span>
                        throws <span class="exceptions"><a href="../exception/UserNotFoundException.html" title="class in aor.fpbackend.exception">UserNotFoundException</a>,
<a href="../exception/InputValidationException.html" title="class in aor.fpbackend.exception">InputValidationException</a></span></div>
<div class="block">Generates a JSON Web Token (JWT) for the given user with specified expiration time and token type.
 <br>
 This method performs the following steps:
 <ul>
     <li>Generates a new UUID as the token ID.</li>
     <li>Sets the issued date to the current date.</li>
     <li>Sets the expiration date based on the current time and the provided expiration time.</li>
     <li>Adds a custom claim for the token type.</li>
     <li>Signs the token with a secret key using the HS512 algorithm.</li>
     <li>Adds user-specific claims if the user is not null, including user ID, username, and role.</li>
 </ul>
 <br></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>user</code> - the user entity for whom the token is being generated. Can be null.</dd>
<dd><code>expirationTime</code> - the expiration time in milliseconds for the token.</dd>
<dd><code>tokenType</code> - the type of the token being generated (e.g., "auth", "session").</dd>
<dt>Returns:</dt>
<dd>a compact representation of the JWT.</dd>
<dt>Throws:</dt>
<dd><code><a href="../exception/UserNotFoundException.html" title="class in aor.fpbackend.exception">UserNotFoundException</a></code> - if the user entity is null.</dd>
<dd><code><a href="../exception/InputValidationException.html" title="class in aor.fpbackend.exception">InputValidationException</a></code> - if the expiration time is less than or equal to 0 or the token type is empty.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="generateNewToken()">
<h3>generateNewToken</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></span>&nbsp;<span class="element-name">generateNewToken</span>()</div>
<div class="block">Generates a new secure random token.
 <br>
 This method performs the following steps:
 <ul>
     <li>Creates an instance of <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/security/SecureRandom.html" title="class or interface in java.security" class="external-link"><code>SecureRandom</code></a> to generate secure random bytes.</li>
     <li>Generates a byte array of 24 random bytes.</li>
     <li>Encodes the random bytes into a URL-safe Base64 string.</li>
 </ul>
 <br></div>
<dl class="notes">
<dt>Returns:</dt>
<dd>a new secure random token as a URL-safe Base64 encoded string.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="validateAuthTokenAndGetUserDetails(java.lang.String)">
<h3>validateAuthTokenAndGetUserDetails</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="../dto/Authentication/AuthUserDto.html" title="class in aor.fpbackend.dto.Authentication">AuthUserDto</a></span>&nbsp;<span class="element-name">validateAuthTokenAndGetUserDetails</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;token)</span>
                                               throws <span class="exceptions"><a href="../exception/InvalidCredentialsException.html" title="class in aor.fpbackend.exception">InvalidCredentialsException</a></span></div>
<div class="block">Validates a JSON Web Token (JWT) and retrieves the authenticated user's details.
 <br>
 This method performs the following steps:
 <ul>
     <li>Checks if the secret key is configured.</li>
     <li>Finds the session associated with the provided token and validates its status.</li>
     <li>Parses the JWT and extracts the claims.</li>
     <li>Retrieves the user's details from the database and constructs an <a href="../dto/Authentication/AuthUserDto.html" title="class in aor.fpbackend.dto.Authentication"><code>AuthUserDto</code></a> object.</li>
 </ul>
 <br></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>token</code> - the JWT to be validated.</dd>
<dt>Returns:</dt>
<dd>an <a href="../dto/Authentication/AuthUserDto.html" title="class in aor.fpbackend.dto.Authentication"><code>AuthUserDto</code></a> containing the authenticated user's details.</dd>
<dt>Throws:</dt>
<dd><code><a href="../exception/InvalidCredentialsException.html" title="class in aor.fpbackend.exception">InvalidCredentialsException</a></code> - if the token is invalid, expired, or if any error occurs during processing.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="validateSessionTokenAndGetUserDetails(java.lang.String)">
<h3>validateSessionTokenAndGetUserDetails</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="../dto/Authentication/AuthUserDto.html" title="class in aor.fpbackend.dto.Authentication">AuthUserDto</a></span>&nbsp;<span class="element-name">validateSessionTokenAndGetUserDetails</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;token)</span>
                                                  throws <span class="exceptions"><a href="../exception/InvalidCredentialsException.html" title="class in aor.fpbackend.exception">InvalidCredentialsException</a></span></div>
<div class="block">Validates a session token and retrieves the authenticated user's details.
 <br>
 This method performs the following steps:
 <ul>
     <li>Checks if the secret key is configured.</li>
     <li>Finds the session associated with the provided token and validates its status.</li>
     <li>Parses the JWT and extracts the claims.</li>
     <li>Retrieves the user's details from the database and constructs an <a href="../dto/Authentication/AuthUserDto.html" title="class in aor.fpbackend.dto.Authentication"><code>AuthUserDto</code></a> object.</li>
 </ul>
 <br></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>token</code> - the session token to be validated.</dd>
<dt>Returns:</dt>
<dd>an <a href="../dto/Authentication/AuthUserDto.html" title="class in aor.fpbackend.dto.Authentication"><code>AuthUserDto</code></a> containing the authenticated user's details.</dd>
<dt>Throws:</dt>
<dd><code><a href="../exception/InvalidCredentialsException.html" title="class in aor.fpbackend.exception">InvalidCredentialsException</a></code> - if the token is invalid, expired, or if any error occurs during processing.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="createNewSessionAndInvalidateOld(aor.fpbackend.dto.Authentication.AuthUserDto,jakarta.ws.rs.container.ContainerRequestContext,long,java.lang.String)">
<h3>createNewSessionAndInvalidateOld</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">createNewSessionAndInvalidateOld</span><wbr><span class="parameters">(<a href="../dto/Authentication/AuthUserDto.html" title="class in aor.fpbackend.dto.Authentication">AuthUserDto</a>&nbsp;authUserDto,
 jakarta.ws.rs.container.ContainerRequestContext&nbsp;requestContext,
 long&nbsp;definedTimeout,
 <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;oldToken)</span>
                                      throws <span class="exceptions"><a href="../exception/UserNotFoundException.html" title="class in aor.fpbackend.exception">UserNotFoundException</a>,
<a href="../exception/InputValidationException.html" title="class in aor.fpbackend.exception">InputValidationException</a>,
<a href="../exception/DatabaseOperationException.html" title="class in aor.fpbackend.exception">DatabaseOperationException</a></span></div>
<div class="block">Creates a new session for the user and invalidates the old session.
 <br>
 This method is called when a session is reactivated due to user activity before the session expires.
 It performs the following steps:
 <ul>
     <li>Finds the user entity based on the user ID from the authenticated user DTO.</li>
     <li>Generates new authentication and session tokens for the user.</li>
     <li>Calculates the expiration time for the new session.</li>
     <li>Persists the new session in the database.</li>
     <li>Sets the new tokens in the request context properties.</li>
     <li>Invalidates the old session token.</li>
 </ul>
 <br></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>authUserDto</code> - the authenticated user DTO containing user details.</dd>
<dd><code>requestContext</code> - the container request context to set new tokens.</dd>
<dd><code>definedTimeout</code> - the defined timeout duration for the session.</dd>
<dd><code>oldToken</code> - the old session token to be invalidated.</dd>
<dt>Throws:</dt>
<dd><code><a href="../exception/UserNotFoundException.html" title="class in aor.fpbackend.exception">UserNotFoundException</a></code> - if the user is not found in the database.</dd>
<dd><code><a href="../exception/InputValidationException.html" title="class in aor.fpbackend.exception">InputValidationException</a></code> - if there is an error with the input validation.</dd>
<dd><code><a href="../exception/DatabaseOperationException.html" title="class in aor.fpbackend.exception">DatabaseOperationException</a></code> - if there is an error persisting the new session.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="createInvalidSession(aor.fpbackend.dto.Authentication.AuthUserDto,jakarta.ws.rs.container.ContainerRequestContext)">
<h3>createInvalidSession</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">createInvalidSession</span><wbr><span class="parameters">(<a href="../dto/Authentication/AuthUserDto.html" title="class in aor.fpbackend.dto.Authentication">AuthUserDto</a>&nbsp;authUserDto,
 jakarta.ws.rs.container.ContainerRequestContext&nbsp;requestContext)</span>
                          throws <span class="exceptions"><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/net/UnknownHostException.html" title="class or interface in java.net" class="external-link">UnknownHostException</a></span></div>
<div class="block">Invalidates the current session and sets invalid tokens in the request context.
 <br>
 This method performs the following steps:
 <ul>
     <li>Invalidates the current session token in the database.</li>
     <li>Generates invalid tokens (value "null") to replace the current tokens.</li>
     <li>Sets the new invalid tokens in the request context properties.</li>
 </ul>
 <br></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>authUserDto</code> - the authenticated user DTO containing user details.</dd>
<dd><code>requestContext</code> - the container request context to set new invalid tokens.</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/net/UnknownHostException.html" title="class or interface in java.net" class="external-link">UnknownHostException</a></code> - if there is an error retrieving host information.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="setSessionDao(aor.fpbackend.dao.SessionDao)">
<h3>setSessionDao</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">setSessionDao</span><wbr><span class="parameters">(<a href="../dao/SessionDao.html" title="class in aor.fpbackend.dao">SessionDao</a>&nbsp;sessionDao)</span></div>
</section>
</li>
<li>
<section class="detail" id="setUserDao(aor.fpbackend.dao.UserDao)">
<h3>setUserDao</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">setUserDao</span><wbr><span class="parameters">(<a href="../dao/UserDao.html" title="class in aor.fpbackend.dao">UserDao</a>&nbsp;userDao)</span></div>
</section>
</li>
<li>
<section class="detail" id="setRoleDao(aor.fpbackend.dao.RoleDao)">
<h3>setRoleDao</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">setRoleDao</span><wbr><span class="parameters">(<a href="../dao/RoleDao.html" title="class in aor.fpbackend.dao">RoleDao</a>&nbsp;roleDao)</span></div>
</section>
</li>
<li>
<section class="detail" id="setConfigurationBean(aor.fpbackend.bean.ConfigurationBean)">
<h3>setConfigurationBean</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">setConfigurationBean</span><wbr><span class="parameters">(<a href="ConfigurationBean.html" title="class in aor.fpbackend.bean">ConfigurationBean</a>&nbsp;configurationBean)</span></div>
</section>
</li>
<li>
<section class="detail" id="setPassEncoder(aor.fpbackend.utils.PassEncoder)">
<h3>setPassEncoder</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">setPassEncoder</span><wbr><span class="parameters">(<a href="../utils/PassEncoder.html" title="class in aor.fpbackend.utils">PassEncoder</a>&nbsp;passEncoder)</span></div>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
</div>
</div>
</body>
</html>
